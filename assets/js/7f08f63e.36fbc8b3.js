"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[544],{6424(e,n,o){o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>u,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"plugins/workflow","title":"WorkflowPlugin","description":"Multi-step workflow execution with retry, rollback, and conditions","source":"@site/docs/plugins/workflow.md","sourceDirName":"plugins","slug":"/plugins/workflow","permalink":"/onegenui-deep-agents/docs/plugins/workflow","draft":false,"unlisted":false,"editUrl":"https://github.com/giulio-leone/onegenui-deep-agents/tree/main/docs/docs/plugins/workflow.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"WorkflowPlugin","description":"Multi-step workflow execution with retry, rollback, and conditions"},"sidebar":"tutorialSidebar","previous":{"title":"GuardrailsPlugin","permalink":"/onegenui-deep-agents/docs/plugins/guardrails"},"next":{"title":"ObservabilityPlugin","permalink":"/onegenui-deep-agents/docs/plugins/observability"}}');var t=o(4848),i=o(8453);const l={sidebar_position:2,title:"WorkflowPlugin",description:"Multi-step workflow execution with retry, rollback, and conditions"},s="WorkflowPlugin",a={},c=[{value:"Quick Start",id:"quick-start",level:2},{value:"How It Works",id:"how-it-works",level:2},{value:"Configuration",id:"configuration",level:2},{value:"WorkflowStep",id:"workflowstep",level:2},{value:"RetryConfig",id:"retryconfig",level:2},{value:"WorkflowResult",id:"workflowresult",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Rollback Behavior",id:"rollback-behavior",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"workflowplugin",children:"WorkflowPlugin"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"WorkflowPlugin"})," executes a sequence of steps before the agent runs. Each step can modify a shared context, have retry logic, define rollback handlers, and be conditionally skipped."]}),"\n",(0,t.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { DeepAgent, createWorkflowPlugin } from "@giulio-leone/gaussflow-agent";\nimport type { WorkflowStep } from "@giulio-leone/gaussflow-agent";\n\nconst steps: WorkflowStep[] = [\n  {\n    id: "fetch-config",\n    name: "Fetch Configuration",\n    execute: async (ctx) => {\n      const res = await fetch("https://api.example.com/config");\n      return { ...ctx, config: await res.json() };\n    },\n  },\n  {\n    id: "validate",\n    name: "Validate Config",\n    condition: (ctx) => ctx.config != null,\n    execute: async (ctx) => {\n      if (!ctx.config.apiKey) throw new Error("Missing API key");\n      return { ...ctx, validated: true };\n    },\n  },\n  {\n    id: "provision",\n    name: "Provision Resources",\n    execute: async (ctx) => {\n      const resource = await provisionResource(ctx.config);\n      return { ...ctx, resourceId: resource.id };\n    },\n    rollback: async (ctx) => {\n      if (ctx.resourceId) await deleteResource(ctx.resourceId);\n    },\n    retry: { maxAttempts: 3, backoffMs: 2000, backoffMultiplier: 2 },\n  },\n];\n\nconst agent = DeepAgent.create({\n  model: openai("gpt-4o"),\n  instructions: "Summarize the provisioned resources.",\n})\n  .use(createWorkflowPlugin({\n    steps,\n    initialContext: { env: "production" },\n  }))\n  .build();\n\nconst result = await agent.run("What was provisioned?");\n'})}),"\n",(0,t.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["The workflow runs in the ",(0,t.jsx)(n.code,{children:"beforeRun"})," hook, ",(0,t.jsx)(n.strong,{children:"before"})," the agent loop starts"]}),"\n",(0,t.jsxs)(n.li,{children:["Steps execute sequentially, each receiving and returning the shared ",(0,t.jsx)(n.code,{children:"WorkflowContext"})]}),"\n",(0,t.jsx)(n.li,{children:"The final context is appended to the agent's prompt as a summary"}),"\n",(0,t.jsx)(n.li,{children:"If a step fails, all previously completed steps are rolled back in reverse order"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface WorkflowPluginConfig {\n  steps: WorkflowStep[];\n  initialContext?: WorkflowContext;  // Default: {}\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"workflowstep",children:"WorkflowStep"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface WorkflowStep {\n  id: string;                                              // Unique step identifier\n  name: string;                                            // Display name\n  execute: (ctx: WorkflowContext) => Promise<WorkflowContext>;  // Step logic\n  condition?: (ctx: WorkflowContext) => boolean;           // Skip if returns false\n  rollback?: (ctx: WorkflowContext) => Promise<void>;      // Cleanup on failure\n  retry?: Partial<RetryConfig>;                            // Retry configuration\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"retryconfig",children:"RetryConfig"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface RetryConfig {\n  maxAttempts: number;       // Default: 3\n  backoffMs: number;         // Default: 1000\n  backoffMultiplier: number; // Default: 2 (exponential backoff)\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Retry uses exponential backoff: ",(0,t.jsx)(n.code,{children:"delay = backoffMs \xd7 backoffMultiplier^(attempt-1)"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"workflowresult",children:"WorkflowResult"}),"\n",(0,t.jsxs)(n.p,{children:["Access the result via ",(0,t.jsx)(n.code,{children:"plugin.getLastResult()"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'const workflow = createWorkflowPlugin({ steps });\n\nconst agent = DeepAgent.create({ model, instructions: "..." })\n  .use(workflow)\n  .build();\n\nawait agent.run("Process results");\n\nconst result = workflow.getLastResult();\nconsole.log(result?.status);         // "completed" | "failed"\nconsole.log(result?.completedSteps); // ["fetch-config", "validate", "provision"]\nconsole.log(result?.skippedSteps);   // []\nconsole.log(result?.totalDurationMs);\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'interface WorkflowResult {\n  status: "completed" | "failed";\n  context: WorkflowContext;\n  completedSteps: string[];\n  skippedSteps: string[];\n  failedStep?: string;        // Only on failure\n  error?: string;             // Only on failure\n  totalDurationMs: number;\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsxs)(n.p,{children:["Failed workflows throw a ",(0,t.jsx)(n.code,{children:"WorkflowError"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { WorkflowError } from "@giulio-leone/gaussflow-agent";\n\ntry {\n  await agent.run("Go");\n} catch (error) {\n  if (error instanceof WorkflowError) {\n    console.log(error.result.failedStep);  // "provision"\n    console.log(error.result.error);       // "Connection timeout"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"rollback-behavior",children:"Rollback Behavior"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Rollbacks execute in ",(0,t.jsx)(n.strong,{children:"reverse order"})," of completed steps"]}),"\n",(0,t.jsxs)(n.li,{children:["Rollback errors are ",(0,t.jsx)(n.strong,{children:"swallowed"})," to ensure all rollbacks are attempted"]}),"\n",(0,t.jsxs)(n.li,{children:["Only steps with a ",(0,t.jsx)(n.code,{children:"rollback"})," handler are rolled back"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453(e,n,o){o.d(n,{R:()=>l,x:()=>s});var r=o(6540);const t={},i=r.createContext(t);function l(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);