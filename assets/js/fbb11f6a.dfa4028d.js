"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[394],{1396(e,n,r){r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"plugins/observability","title":"ObservabilityPlugin","description":"Three-pillar observability \u2014 tracing, metrics, and logging","source":"@site/docs/plugins/observability.md","sourceDirName":"plugins","slug":"/plugins/observability","permalink":"/onegenui-deep-agents/docs/plugins/observability","draft":false,"unlisted":false,"editUrl":"https://github.com/giulio-leone/onegenui-deep-agents/tree/main/docs/docs/plugins/observability.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"ObservabilityPlugin","description":"Three-pillar observability \u2014 tracing, metrics, and logging"},"sidebar":"tutorialSidebar","previous":{"title":"WorkflowPlugin","permalink":"/onegenui-deep-agents/docs/plugins/workflow"},"next":{"title":"OneCrawlPlugin","permalink":"/onegenui-deep-agents/docs/plugins/oncrawl"}}');var s=r(4848),i=r(8453);const d={sidebar_position:3,title:"ObservabilityPlugin",description:"Three-pillar observability \u2014 tracing, metrics, and logging"},l="ObservabilityPlugin",o={},c=[{value:"Quick Start",id:"quick-start",level:2},{value:"Configuration",id:"configuration",level:2},{value:"What Gets Instrumented",id:"what-gets-instrumented",level:2},{value:"Tracing",id:"tracing",level:3},{value:"Metrics",id:"metrics",level:3},{value:"Logging",id:"logging",level:3},{value:"Observability Ports",id:"observability-ports",level:2},{value:"TracingPort",id:"tracingport",level:3},{value:"MetricsPort",id:"metricsport",level:3},{value:"LoggingPort",id:"loggingport",level:3},{value:"Built-in Adapters",id:"built-in-adapters",level:2},{value:"Custom Adapters",id:"custom-adapters",level:2},{value:"Hooks Used",id:"hooks-used",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"observabilityplugin",children:"ObservabilityPlugin"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"ObservabilityPlugin"})," provides three-pillar observability by integrating ",(0,s.jsx)(n.code,{children:"TracingPort"}),", ",(0,s.jsx)(n.code,{children:"MetricsPort"}),", and ",(0,s.jsx)(n.code,{children:"LoggingPort"}),". All three are optional \u2014 use any combination."]}),"\n",(0,s.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import {\n  DeepAgent,\n  createObservabilityPlugin,\n  InMemoryTracingAdapter,\n  InMemoryMetricsAdapter,\n  ConsoleLoggingAdapter,\n} from "@giulio-leone/gaussflow-agent";\n\nconst tracer = new InMemoryTracingAdapter();\nconst metrics = new InMemoryMetricsAdapter();\nconst logger = new ConsoleLoggingAdapter();\n\nconst agent = DeepAgent.create({\n  model: openai("gpt-4o"),\n  instructions: "You are a helpful assistant.",\n})\n  .use(createObservabilityPlugin({ tracer, metrics, logger }))\n  .build();\n\nawait agent.run("Hello!");\n'})}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface ObservabilityPluginConfig {\n  tracer?: TracingPort;     // Distributed tracing\n  metrics?: MetricsPort;    // Counters, histograms, gauges\n  logger?: LoggingPort;     // Structured logging\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"All fields are optional. The plugin gracefully skips any pillar that isn't configured."}),"\n",(0,s.jsx)(n.h2,{id:"what-gets-instrumented",children:"What Gets Instrumented"}),"\n",(0,s.jsx)(n.h3,{id:"tracing",children:"Tracing"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Span"}),(0,s.jsx)(n.th,{children:"Created"}),(0,s.jsx)(n.th,{children:"Attributes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"agent.run"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"beforeRun"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"session.id"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"tool.<name>"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"beforeTool"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"tool.call.id"}),", ",(0,s.jsx)(n.code,{children:"duration.ms"})]})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["Spans are hierarchical \u2014 tool spans are children of the ",(0,s.jsx)(n.code,{children:"agent.run"})," span. On error, all active spans are ended with status ",(0,s.jsx)(n.code,{children:'"error"'}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"metrics",children:"Metrics"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Metric"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"When"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"agent.runs.total"})}),(0,s.jsx)(n.td,{children:"Counter"}),(0,s.jsx)(n.td,{children:"Each agent run starts"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"agent.runs.success"})}),(0,s.jsx)(n.td,{children:"Counter"}),(0,s.jsx)(n.td,{children:"Agent run completes successfully"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"agent.runs.errors"})}),(0,s.jsx)(n.td,{children:"Counter"}),(0,s.jsx)(n.td,{children:"Agent run errors"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"agent.tools.total"})}),(0,s.jsx)(n.td,{children:"Counter"}),(0,s.jsx)(n.td,{children:"Each tool call (labeled by tool name)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"agent.tool.duration.ms"})}),(0,s.jsx)(n.td,{children:"Histogram"}),(0,s.jsx)(n.td,{children:"Each tool call completes"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"logging",children:"Logging"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Level"}),(0,s.jsx)(n.th,{children:"Message"}),(0,s.jsx)(n.th,{children:"Context"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"info"})}),(0,s.jsx)(n.td,{children:'"Agent run started"'}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"{ sessionId }"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"info"})}),(0,s.jsx)(n.td,{children:'"Agent run completed"'}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"{ sessionId }"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"debug"})}),(0,s.jsx)(n.td,{children:'"Tool call started"'}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"{ sessionId, tool }"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"debug"})}),(0,s.jsx)(n.td,{children:'"Tool call completed"'}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"{ tool, durationMs }"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"error"})}),(0,s.jsx)(n.td,{children:'"Agent error"'}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"{ sessionId, error }"})})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"observability-ports",children:"Observability Ports"}),"\n",(0,s.jsx)(n.h3,{id:"tracingport",children:"TracingPort"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'interface TracingPort {\n  startSpan(name: string, parentSpan?: Span): Span;\n}\n\ninterface Span {\n  readonly traceId: string;\n  readonly spanId: string;\n  readonly name: string;\n  setAttribute(key: string, value: string | number | boolean): void;\n  setStatus(status: "ok" | "error", message?: string): void;\n  end(): void;\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"metricsport",children:"MetricsPort"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface MetricsPort {\n  incrementCounter(name: string, value?: number, labels?: Record<string, string>): void;\n  recordHistogram(name: string, value: number, labels?: Record<string, string>): void;\n  recordGauge(name: string, value: number, labels?: Record<string, string>): void;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"loggingport",children:"LoggingPort"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'type LogLevel = "debug" | "info" | "warn" | "error";\n\ninterface LoggingPort {\n  log(level: LogLevel, message: string, context?: Record<string, unknown>): void;\n  debug(message: string, context?: Record<string, unknown>): void;\n  info(message: string, context?: Record<string, unknown>): void;\n  warn(message: string, context?: Record<string, unknown>): void;\n  error(message: string, context?: Record<string, unknown>): void;\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"built-in-adapters",children:"Built-in Adapters"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Port"}),(0,s.jsx)(n.th,{children:"Adapter"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"TracingPort"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"InMemoryTracingAdapter"})}),(0,s.jsx)(n.td,{children:"Stores spans in memory. Good for testing."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"MetricsPort"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"InMemoryMetricsAdapter"})}),(0,s.jsx)(n.td,{children:"Stores counters/histograms in memory."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"LoggingPort"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ConsoleLoggingAdapter"})}),(0,s.jsxs)(n.td,{children:["Logs to ",(0,s.jsx)(n.code,{children:"console.*"})," with structured format."]})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"custom-adapters",children:"Custom Adapters"}),"\n",(0,s.jsx)(n.p,{children:"Implement the port interfaces to integrate with your observability stack:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import type { TracingPort, Span } from "@giulio-leone/gaussflow-agent";\n\nclass OpenTelemetryAdapter implements TracingPort {\n  startSpan(name: string, parentSpan?: Span): Span {\n    // Bridge to OpenTelemetry SDK\n    const otelSpan = tracer.startSpan(name, { parent: parentSpan });\n    return {\n      traceId: otelSpan.spanContext().traceId,\n      spanId: otelSpan.spanContext().spanId,\n      name,\n      setAttribute: (k, v) => otelSpan.setAttribute(k, v),\n      setStatus: (s, msg) => otelSpan.setStatus({ code: s === "ok" ? 1 : 2, message: msg }),\n      end: () => otelSpan.end(),\n    };\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"hooks-used",children:"Hooks Used"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Hook"}),(0,s.jsx)(n.th,{children:"Purpose"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"beforeRun"})}),(0,s.jsx)(n.td,{children:"Start root span, log run start, increment run counter"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"afterRun"})}),(0,s.jsx)(n.td,{children:"End root span, log completion, increment success counter"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"beforeTool"})}),(0,s.jsx)(n.td,{children:"Start child span, log tool start, increment tool counter"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"afterTool"})}),(0,s.jsx)(n.td,{children:"End tool span with duration, log completion, record histogram"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"onError"})}),(0,s.jsx)(n.td,{children:"End all spans with error status, log error, increment error counter"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453(e,n,r){r.d(n,{R:()=>d,x:()=>l});var t=r(6540);const s={},i=t.createContext(s);function d(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);