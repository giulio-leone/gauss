"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[443],{936(e,n,r){r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"architecture","title":"Architecture","description":"Hexagonal architecture with ports, adapters, and plugins","source":"@site/docs/architecture.md","sourceDirName":".","slug":"/architecture","permalink":"/onegenui-deep-agents/docs/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/giulio-leone/onegenui-deep-agents/tree/main/docs/docs/architecture.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Architecture","description":"Hexagonal architecture with ports, adapters, and plugins"},"sidebar":"tutorialSidebar","previous":{"title":"Getting Started","permalink":"/onegenui-deep-agents/docs/intro"},"next":{"title":"Plugins","permalink":"/onegenui-deep-agents/docs/plugins/"}}');var s=r(4848),i=r(8453);const d={sidebar_position:2,title:"Architecture",description:"Hexagonal architecture with ports, adapters, and plugins"},c="Hexagonal Architecture",o={},l=[{value:"Architecture Diagram",id:"architecture-diagram",level:2},{value:"Ports",id:"ports",level:2},{value:"Adapters",id:"adapters",level:2},{value:"Plugins",id:"plugins",level:2},{value:"Plugin Lifecycle Hooks",id:"plugin-lifecycle-hooks",level:3},{value:"AbstractBuilder",id:"abstractbuilder",level:2},{value:"BasePlugin",id:"baseplugin",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"hexagonal-architecture",children:"Hexagonal Architecture"})}),"\n",(0,s.jsxs)(n.p,{children:["GaussFlow follows ",(0,s.jsx)(n.strong,{children:"hexagonal architecture"})," (also known as ports & adapters). The core domain (",(0,s.jsx)(n.code,{children:"DeepAgent"}),") depends only on port interfaces \u2014 never on concrete implementations. Adapters implement those interfaces for specific platforms and services."]}),"\n",(0,s.jsx)(n.h2,{id:"architecture-diagram",children:"Architecture Diagram"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     DeepAgent (Orchestrator)                         \u2502\n\u2502                                                                      \u2502\n\u2502  EventBus \u2500 ApprovalMgr \u2500 TokenTracker \u2500 ContextMgr \u2500 PluginMgr    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502              \u2502              \u2502              \u2502\n  \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2510\n  \u2502  Ports  \u2502   \u2502   Ports   \u2502  \u2502  Ports  \u2502  \u2502   Ports   \u2502\n  \u2502(inbound)\u2502   \u2502 (outbound)\u2502  \u2502(observe)\u2502  \u2502 (infra)   \u2502\n  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n  \u2502PluginPort\u2502  \u2502Filesystem \u2502  \u2502Tracing  \u2502  \u2502RuntimePort\u2502\n  \u2502ModelPort \u2502  \u2502MemoryPort \u2502  \u2502Metrics  \u2502  \u2502Validation \u2502\n  \u2502Consensus \u2502  \u2502McpPort    \u2502  \u2502Logging  \u2502  \u2502TokenCount \u2502\n  \u2502          \u2502  \u2502LearningPt \u2502  \u2502         \u2502  \u2502           \u2502\n  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502              \u2502              \u2502              \u2502\n  \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2510\n  \u2502Adapters \u2502   \u2502 Adapters  \u2502  \u2502Adapters \u2502  \u2502 Adapters  \u2502\n  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n  \u2502BasePlugin\u2502  \u2502VirtualFS  \u2502  \u2502InMemory \u2502  \u2502NodeRuntime\u2502\n  \u2502Guardrails\u2502  \u2502LocalFS    \u2502  \u2502 Tracing \u2502  \u2502DenoRuntime\u2502\n  \u2502Workflow  \u2502  \u2502InMemoryMem\u2502  \u2502InMemory \u2502  \u2502BunRuntime \u2502\n  \u2502Observ.   \u2502  \u2502Supabase   \u2502  \u2502 Metrics \u2502  \u2502EdgeRuntime\u2502\n  \u2502OneCrawl  \u2502  \u2502AiSdkMcp   \u2502  \u2502Console  \u2502  \u2502ZodValid. \u2502\n  \u2502Vectorless\u2502  \u2502GaussFlowMcp\u2502  \u2502 Logging \u2502  \u2502Approximate\u2502\n  \u2502Evals     \u2502  \u2502InMemLearn \u2502  \u2502         \u2502  \u2502Tiktoken   \u2502\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.h2,{id:"ports",children:"Ports"}),"\n",(0,s.jsxs)(n.p,{children:["Ports are TypeScript interfaces that define contracts. They live in ",(0,s.jsx)(n.code,{children:"src/ports/"}),":"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Port"}),(0,s.jsx)(n.th,{children:"Purpose"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"FilesystemPort"})}),(0,s.jsx)(n.td,{children:"File operations with zone-based isolation"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"MemoryPort"})}),(0,s.jsx)(n.td,{children:"Persistent state (todos, checkpoints, conversations)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"McpPort"})}),(0,s.jsx)(n.td,{children:"MCP server discovery and tool execution"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ModelPort"})}),(0,s.jsx)(n.td,{children:"LLM invocation abstraction"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"PluginPort"})}),(0,s.jsx)(n.td,{children:"Plugin lifecycle hooks and tool injection"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RuntimePort"})}),(0,s.jsx)(n.td,{children:"Platform-agnostic runtime APIs (UUID, env, fetch)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"TokenCounterPort"})}),(0,s.jsx)(n.td,{children:"Token counting, budgeting, cost estimation"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"LearningPort"})}),(0,s.jsx)(n.td,{children:"Cross-session user profiles and memories"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ValidationPort"})}),(0,s.jsx)(n.td,{children:"Engine-agnostic data validation"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"TracingPort"})}),(0,s.jsx)(n.td,{children:"Distributed tracing with spans"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"MetricsPort"})}),(0,s.jsx)(n.td,{children:"Counters, histograms, gauges"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"LoggingPort"})}),(0,s.jsx)(n.td,{children:"Structured logging"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ConsensusPort"})}),(0,s.jsx)(n.td,{children:"Fork result evaluation strategy"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"adapters",children:"Adapters"}),"\n",(0,s.jsx)(n.p,{children:"Adapters are concrete implementations. The framework ships with defaults for every port:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Port"}),(0,s.jsx)(n.th,{children:"Default Adapter"}),(0,s.jsx)(n.th,{children:"Alternatives"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"FilesystemPort"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"VirtualFilesystem"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"LocalFilesystem"})," (Node.js), ",(0,s.jsx)(n.code,{children:"DenoFilesystem"}),", ",(0,s.jsx)(n.code,{children:"OpfsFilesystem"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"MemoryPort"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"InMemoryAdapter"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"SupabaseMemoryAdapter"}),", ",(0,s.jsx)(n.code,{children:"DenoKvMemoryAdapter"}),", ",(0,s.jsx)(n.code,{children:"IndexedDbMemoryAdapter"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RuntimePort"})}),(0,s.jsx)(n.td,{children:"Auto-detected"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"NodeRuntimeAdapter"}),", ",(0,s.jsx)(n.code,{children:"DenoRuntimeAdapter"}),", ",(0,s.jsx)(n.code,{children:"BunRuntimeAdapter"}),", ",(0,s.jsx)(n.code,{children:"EdgeRuntimeAdapter"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"TokenCounterPort"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ApproximateTokenCounter"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"TiktokenTokenCounter"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ValidationPort"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ZodValidationAdapter"})}),(0,s.jsx)(n.td,{children:"Custom implementations"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"TracingPort"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"InMemoryTracingAdapter"})}),(0,s.jsx)(n.td,{children:"Custom (e.g., OpenTelemetry)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"MetricsPort"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"InMemoryMetricsAdapter"})}),(0,s.jsx)(n.td,{children:"Custom (e.g., Prometheus)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"LoggingPort"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ConsoleLoggingAdapter"})}),(0,s.jsx)(n.td,{children:"Custom (e.g., Pino, Winston)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ConsensusPort"})}),(0,s.jsx)(n.td,{children:"\u2014"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"LlmJudgeConsensus"}),", ",(0,s.jsx)(n.code,{children:"MajorityVoteConsensus"}),", ",(0,s.jsx)(n.code,{children:"DebateConsensus"})]})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"plugins",children:"Plugins"}),"\n",(0,s.jsxs)(n.p,{children:["Plugins extend agent behavior through ",(0,s.jsx)(n.strong,{children:"lifecycle hooks"})," and ",(0,s.jsx)(n.strong,{children:"tool injection"}),". They follow a deterministic execution order based on registration:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import { DeepAgent, createGuardrailsPlugin, createEvalsPlugin } from "@giulio-leone/gaussflow-agent";\n\nconst agent = DeepAgent.create({ model, instructions: "..." })\n  .use(createGuardrailsPlugin({ /* ... */ }))  // Runs first\n  .use(createEvalsPlugin())                     // Runs second\n  .build();\n'})}),"\n",(0,s.jsx)(n.h3,{id:"plugin-lifecycle-hooks",children:"Plugin Lifecycle Hooks"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Hook"}),(0,s.jsx)(n.th,{children:"When"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"beforeRun"})}),(0,s.jsx)(n.td,{children:"Before the agent loop starts \u2014 can modify the prompt"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"afterRun"})}),(0,s.jsx)(n.td,{children:"After the agent loop completes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"beforeTool"})}),(0,s.jsx)(n.td,{children:"Before a tool is executed \u2014 can modify args or skip"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"afterTool"})}),(0,s.jsx)(n.td,{children:"After a tool returns"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"beforeStep"})}),(0,s.jsx)(n.td,{children:"Before each step in the loop"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"afterStep"})}),(0,s.jsx)(n.td,{children:"After each step"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"onError"})}),(0,s.jsx)(n.td,{children:"When an error occurs \u2014 can suppress it"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"abstractbuilder",children:"AbstractBuilder"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"AbstractBuilder<T>"})," provides a template method pattern used by ",(0,s.jsx)(n.code,{children:"DeepAgentBuilder"})," and ",(0,s.jsx)(n.code,{children:"AgentGraphBuilder"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import { AbstractBuilder } from "@giulio-leone/gaussflow-agent";\n\nabstract class AbstractBuilder<T> {\n  protected abstract validate(): void;\n  protected abstract construct(): T;\n\n  build(): T {\n    this.validate();    // Throws if invalid\n    return this.construct();\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"This ensures all builders validate their configuration before constructing the target object."}),"\n",(0,s.jsx)(n.h2,{id:"baseplugin",children:"BasePlugin"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"BasePlugin"})," abstract class provides the skeleton for plugin development:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import { BasePlugin } from "@giulio-leone/gaussflow-agent";\nimport type { PluginHooks } from "@giulio-leone/gaussflow-agent";\n\nclass MyPlugin extends BasePlugin {\n  readonly name = "my-plugin";\n\n  protected buildHooks(): PluginHooks {\n    return {\n      beforeRun: async (ctx, params) => {\n        // Your logic here\n      },\n    };\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"BasePlugin"})," handles ",(0,s.jsx)(n.code,{children:"name"}),", ",(0,s.jsx)(n.code,{children:"version"})," (defaults to ",(0,s.jsx)(n.code,{children:'"1.0.0"'}),"), and hook registration."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453(e,n,r){r.d(n,{R:()=>d,x:()=>c});var t=r(6540);const s={},i=t.createContext(s);function d(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);